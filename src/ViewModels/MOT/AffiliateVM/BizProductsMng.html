<template>
     <style>
           .splash .fa-spin{
                font-size:20px !important;
                margin-top:-90px;
                margin-right:10px;
           }
     </style>    
    <section>
        <h3 style="margin-bottom: 30px;"><b>QUẢN LÝ SẢN PHẨM</b></h3>
        <div style="float:right;">
                 <div class="splash" if.bind="!pendding">
                    <i class="fa fa-spinner fa-spin"></i>
                </div>
         </div>
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">Lọc</h3>
            </div>
            <div class="panel-body">
                <form role="form">
                    <div class="row">
                        <div class="form-group col-md-2">
                            <label for=""> Chọn Hệ thống </label>
                            <br />
                            <select name="Business" value.two-way="BusinessId" value.bind="BusinessId" class="form-control biz-product-filter-width"
                                change.delegate="ChangeBusiness()">
                                <option value="0">-- Chọn Hệ thống --</option>
                                <option repeat.for="item of Business" model.bind="item.BusinessId" value.bind="item.BusinessId"> ${item.Name}</option>
                            </select>
                            <br />
                            <!--<button type="button" class="btn btn-warning btn-xs" data-toggle="modal" data-target="#addBusiness" style="margin-top: 10px;">Thêm Đối tác</button>-->
                        </div>
                        <div class="form-group col-md-2">
                            <label for="">Chọn Chương trình </label>
                            <br />
                            <select name="BizCampaign" ref="refCampaign" value.two-way="CampaignId" value.bind="CampaignId" class="form-control biz-product-filter-width"
                                change.delegate="ChangeCampaign()">
                                <option value="0">-- Chọn Chương trình --</option>
                                <option repeat.for="item of BizCampaigns" value.bind="item.BusinessCampaignId"> ${item.Name}</option>
                            </select>
                            <br />
                            <!--<button type="button" class="btn btn-warning btn-xs" data-toggle="modal" data-target="#addCampaign" style="margin-top: 10px;">Thêm Chương trình</button>-->
                        </div>
                        <div class="form-group col-md-2">
                            <label for="">Mã sản phẩm/Mã màu</label>
                            <br />
                            <input type="text" class="form-control" ref="searchByCode">
                        </div>
                        <div class="form-group col-md-3">
                            <label for="column">Sắp xếp theo:</label>
                            <br/>
                            <div class="input-group">
                                <select id="column" ref="column" class="form-control" style="width: 51% !important;float:left;">
                                    <option value="ProductId">Mã sản phẩm</option>
                                    <option value="ProductCode">Mã sản phẩm (POS)</option>
                                    <option value="ProductColorCode">Mã màu</option>
                                </select>
                                <select ref="direction" class="form-control" style="width: 46% !important;float:right;">
                                    <option value="ascending">Tăng dần</option>
                                    <option value="descending">Giảm dần</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group col-md-3">
                            <label for="column">
                                Khoảng thời gian
                            </label>
                            <br/>
                            <div class="input-group input-daterange date">
                                <input type="text" id="txtFilterDateStart" class="form-control" style="width: 51% !important;float:left" placeholder="Ngày bắt đầu">
                                <input type="text" id="txtFilterDateEnd" class="form-control" style="width: 46% !important;float:right" placeholder="Ngày kết thúc">
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
         
        <br/>
        <button type="button" class="btn btn-primary" click.delegate='goToUpload()' style="margin-bottom:20px">Tạo mới Upload File</button>
        <button type="button" class="btn btn-danger" style.bind="showErrorProducts==true?'background:#337ab7; border-color:#337ab7; margin-bottom: 20px;':'background:#d9534f; border-color:#d9534f; margin-bottom: 20px;'"
            click.delegate="showErrorProducts=!showErrorProducts">
            <span class="glyphicon glyphicon-filter"></span> <span if.bind="!showErrorProducts">Lọc sản phẩm lỗi</span> <span if.bind="showErrorProducts">Không lọc s
ản phẩm lỗi</span>
        </button>
        <button type="button" class="btn btn-primary" click.delegate='syncProduct()' style="margin-bottom:20px;float:right">Đồng bộ sản phẩm Web</button>
        <br />

        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">Đổi Products Status <span style="color: red;">(Hãy chọn product ở danh sách phía dưới trước để thay đổi status.)</span></h3>
               
            </div>
            <div class="panel-body">
                <form class="form-inline" role="form" data-toggle="tooltip" title="Select products on below table before for changing status.">
                    <div class="row">
                        <div class="form-group col-md-8" style="display: inline;">
                            <label for=""> Chọn Status mới </label>
                            <select value.two-way="newStatus" class="form-control" style="display: inline-block; width: 10% !important;">
                                <option value="A">Active</option>
                                <option value="D">Deactive</option>
                            </select>
                            <button type="button" class="btn btn-warning btn-xs" click.delegate="UpdateSelectedBizProductsStatus()">Cập nhật</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        <div class="table-responsive">
            <!-- <table id="tableBizProducts" class="table table-bordered"> -->

            <table id="tableBizProducts" class="table table-bordered">
                <thead>
                    <tr>
                        <th>
                            <input type="checkbox" checked.bind="checkAll" click.trigger="SelectAllBizProducts()">
                        </th>
                        <th>STT</th>
                        <!-- <th>ID</th> -->
                        <th style="width: 10%">Tên sản phẩm</th>
                        <th>Mã sản phẩm</th>
                        <th style="width: 5%">Mã sản phẩm (POS)</th>
                        <th style="width: 5%">Tên màu</th>
                        <th style="width: 5%">DisplayType</th>
                        <th style="width: 5%">PromotionType</th>
                        <th style="width: 5%">Mã màu</th>
                        <th style="width: 5%">Mã chi nhánh</th>
                        <th style="width: 10%">Ngày bắt đầu</th>
                        <th style="width: 10%">Ngày kết thúc</th>
                        <th style="width: 5%">Tình trạng</th>
                        <th>Mô tả khuyến mãi</th>
                        <th style="width: 5%">Ngày thay đổi</th>
                        <th style="width: 5%">Hành động</th>
                    </tr>
                </thead>
                <tbody ref="mydata" items.bind="BizProducts | filterByIdOrCode: searchByCode.value | sort:column.value:direction.value | filterByErrorProducts:showErrorProducts | filterByRangeDate:dateStartFilter:dateEndFilter">
                    <tr repeat.for="product of mydata.items | takeFromTo: (current-1)* (itemperpage):current * (itemperpage) ">
                        <td>
                            <input type="checkbox" checked.bind="product.checked">
                        </td>
                        <td>${(current-1)*10+$index+1}</td>
                        <td>${product.ProductName}</td>
                        <td>${product.ProductId}</td>
                        <td>${product.ProductCode}</td>
                        <td>${product.ColorName}</td>
                        <td>${product.DisplayType}</td>
                        <td>${product.PromotionType}</td>
                        <td>${product.ProductColorCode}</td>
                        <td>${product.StoreCode}</td>
                        <td>
                            <span if.bind="!show">${product.DateStart | dateFormat:'M/D/YYYY hh:mm:ss a'}</span>
                            <div class="input-group date" if.bind="show">
                                <input type="text" id="dtProductStartDate" class="form-control" value="${product.DateStart | dateFormat:'M/D/YYYY hh:mm:ss a'}">
                                <span class="input-group-addon"><i class="glyphicon glyphicon-th"></i></span>
                            </div>
                        </td>
                        <td>
                            <span if.bind="!show">${product.DateEnd | dateFormat:'M/D/YYYY hh:mm:ss a'}</span>
                            <div class="input-group date" if.bind="show">
                                <input type="text" id="dtProductEndDate" class="form-control" value="${product.DateEnd | dateFormat:'M/D/YYYY hh:mm:ss a'}">
                                <span class="input-group-addon"><i class="glyphicon glyphicon-th"></i></span>
                            </div>
                        </td>
                        <td>
                            <span if.bind="!show">${product.Status == "A" ? "Active" : "Deactive"}</span>
                            <select if.bind="show" value.bind="product.Status" class="form-control">
                                <option value="A">Active</option>
                                <option value="D">Deactive</option>
                            </select>
                        </td>
                        <td>${product.PromotionDescription}</td>
                        <td>${product.ModifiedDate | dateFormat:'M/D/YYYY hh:mm:ss a'}</td>
                        <td>
                            <button type="button" class="btn btn-info btn-xs" data-toggle="modal" data-target="#editProduct" click.delegate="$parent.EditProduct(product)">
                                <span class="glyphicon glyphicon-edit"></span> Sửa
                            </button>
                        </td>
                    </tr>
                    <tr if.bind="mydata.items.length > 0">
                        <td colspan="16">
                            <pagination page-size.bind="pagesize" total.bind="mydata.items.length" item-per-page.bind="itemperpage" current-page.bind="current"></pagination>
                        </td>
                    </tr>
                </tbody>
                <tbody if.bind="mydata.items.length <= 0">
                    <tr>
                        <td colspan="16">
                            Không có sản phẩm.
                        </td>
                    </tr>
                </tbody>
            </table>

            <div>
                <!-- EDIT SAN PHAM -->
                <div id="editProduct" class="modal fade" role="dialog">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal">&times;</button>
                                <h4 class="modal-title">Cập nhật Sản phẩm</h4>
                            </div>
                            <div class="modal-body">
                                <div class="row">
                                    <div class="col-xs-4 form-group required">
                                        <label class="control-label">Ngày bắt đầu</label>
                                        <div class="input-group dateBiz">
                                            <input type="text" id="dtSelectedProductForEditingDateStart" class="form-control" value.two-way="selectedProductForEditing.DateStart | dateFormat:'M/D/YYYY hh:mm:ss a'">
                                            <span class="input-group-addon"><i class="glyphicon glyphicon-th"></i></span>
                                        </div>
                                    </div>
                                    <div class="col-xs-4 form-group required">
                                        <label class="control-label">Ngày kết thúc</label>
                                        <div class="input-group dateBiz">
                                            <input type="text" id="dtSelectedProductForEditingDateEnd" class="form-control" value.two-way="selectedProductForEditing.DateEnd | dateFormat:'M/D/YYYY hh:mm:ss a'">
                                            <span class="input-group-addon"><i class="glyphicon glyphicon-th"></i></span>
                                        </div>
                                    </div>
                                    <div class="col-xs-4 form-group required">
                                        <label class="control-label">Trạng thái</label>
                                        <select value.two-way="selectedProductForEditing.Status" class="form-control">
                                            <option value="A">Active</option>
                                            <option value="D">Deactive</option>
                                        </select>
                                    </div>
                                    <div class="col-xs-4 form-group required">
                                        <label class="control-label">DisplayType</label>
                                        <select value.two-way="selectedProductForEditing.DisplayType" class="form-control">
                                            <option value="">Chọn DisplayType</option>
                                            <option value="HIDE_PRICE">HIDE_PRICE</option>
                                            <option value="SHOW_PRICE">SHOW_PRICE</option>
                                        </select>

                                    </div>
                                    <div class="col-xs-4 form-group required">
                                        <label class="control-label">PromotionType</label>
                                        <select value.two-way="selectedProductForEditing.PromotionType" class="form-control">
                                            <option value="">Chọn PromotionType</option>
                                            <option value="KM_TG">KM_TG</option>
                                            <option value="KM">KM</option>
                                            <option value="TG">TG</option>
                                            <option value="NONE">NONE</option>
                                        </select>
                                    </div>
                                    <div class="col-xs-12 form-group required">
                                        <label class="control-label">Mô tả khuyến mãi</label>
                                        <div id="PromotionDescription"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <span style="float: left; color: red">(*) là các trường bắt buộc nhập</span>
                                <button type="button" class="btn btn-primary" click.delegate="UpdateBizAllProductCode(selectedProductForEditing)">Áp dụng tất cả mã Code</button>
                                <button type="button" class="btn btn-danger" click.delegate="UpdateBizProduct(selectedProductForEditing)">Cập nhật</button>
                                <button type="button" class="btn btn-default" data-dismiss="modal">Đóng</button>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- ADD BUSINESS -->
                <div id="addBusiness" class="modal fade" role="dialog">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal">&times;</button>
                                <h4 class="modal-title">Thêm mới Đối tác</h4>
                            </div>
                            <div class="modal-body">
                                <div class="row">
                                    <div class="col-xs-6 form-group required">
                                        <label class="control-label">Tên</label>
                                        <input class="form-control" type="text" value.bind="BizForm.Name" />
                                    </div>
                                    <div class="col-xs-6 form-group">
                                        <label>Mô tả</label>
                                        <input class="form-control" type="textarea" value.bind="BizForm.Descriptions" />
                                    </div>
                                    <div class="col-xs-6 form-group required">
                                        <label class="control-label">Người dùng</label>
                                        <input class="form-control" type="text" value.bind="BizForm.User" />
                                    </div>
                                    <div class="col-xs-6 form-group required">
                                        <label class="control-label">Mật khẩu</label>
                                        <input class="form-control" type="password" value.bind="BizForm.Pass" />
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <span style="float: left; color: red">(*) là các trường bắt buộc nhập</span>
                                <button type="button" class="btn btn-default" click.delegate="SubmitBusiness()">Thêm</button>
                                <button type="button" class="btn btn-default" data-dismiss="modal">Đóng</button>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- ADD CAMPAIGN -->
                <div id="addCampaign" class="modal fade" role="dialog">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal">&times;</button>
                                <h4 class="modal-title">Thêm mới Chương trình</h4>
                            </div>
                            <div class="modal-body">
                                <div class="row">
                                    <div class="col-xs-6 form-group required">
                                        <label class="control-label">Đối tác</label>
                                        <select name="BusinessCampaign" class="form-control" value.two-way="BizFormOnCampaign.Business_id">
                                            <option value=""> --- Chọn đối tác ---</option>
                                            <option repeat.for="item of Business" value.bind="item.BusinessId"> ${item.Name}</option>
                                        </select>
                                    </div>
                                    <div class="col-xs-6 form-group required">
                                        <label class="control-label">Tên</label>
                                        <input class="form-control" type="text" value.bind="CampaignForm.Name" />
                                    </div>
                                    <div class="col-xs-6 form-group required">
                                        <label class="control-label">Ngày Bắt Đầu</label>
                                        <br />
                                        <div class="input-group date">
                                            <input type="text" id="dtCampaignDateStart" class="form-control" value.two-way="CampaignForm.Date_start | dateFormat:'M/D/YYYY hh:mm:ss a'">
                                            <span class="input-group-addon"><i class="glyphicon glyphicon-th"></i></span>
                                        </div>
                                    </div>
                                    <div class="col-xs-6 form-group required">
                                        <label class="control-label">Ngày Kết Thúc</label>
                                        <br />
                                        <div class="input-group date">
                                            <input type="text" id="dtCampaignDateEnd" class="form-control" value.two-way="CampaignForm.Date_end | dateFormat:'M/D/YYYY hh:mm:ss a'">
                                            <span class="input-group-addon"><i class="glyphicon glyphicon-th"></i></span>
                                        </div>
                                    </div>
                                    <div class="col-xs-6 form-group">
                                        <label class="control-label">Discount Code</label>
                                        <input class="form-control" type="textarea" value.bind="CampaignForm.Discount_code" />
                                    </div>
                                    <div class="col-xs-6 form-group">
                                        <label class="control-label">Mô tả</label>
                                        <input class="form-control" type="text" value.bind="CampaignForm.Description" />
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <span style="float: left; color: red">(*) là các trường bắt buộc nhập</span>
                                <button type="button" class="btn btn-primary" click.delegate="SubmitCampaign()">Thêm</button>
                                <button type="button" class="btn btn-default" data-dismiss="modal">Đóng</button>
                            </div>
                        </div>
                    </div>
                </div>
    </section>
    <style type="text/css">
        tr:nth-child(even) {
            background-color: #f2f2f2
        }
        
        .form-group.required .control-label:after {
            content: " *";
            color: red;
        }
        
        .form-inline .form-control {
            width: 80% !important;
        }
        
        .datepicker {
            z-index: 99999 !important;
        }
    </style>
</template>