<template>
  <h3 style="margin-bottom: 30px; margin-left: 19px;"><b>CẤU HÌNH ĐIỀU KIỆN QUAY</b></h3>
  <section if.bind="!isNoAccess">
  
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Lọc</h3>
      </div>
      <div class="panel-body">
        <form class="form-inline form-filter" role="form">
          <div class="row">
            <div class="form-group col-md-2">
              <label for=""> Chọn Chi nhánh </label>
              <br />
              <select id="filterByBranch" value.two-way="filterBranch" class="form-control">
                <option value="">Tất cả Chi nhánh </option>
                <option repeat.for="item of ListBranchs" value.bind="item.BranchsCodePos"> ${item.BranchsCodePos} - ${item.BranchsAdd}</option>
              </select>
            </div>
             <div class="form-group col-md-2">
              <label for=""> Chọn Chương trình </label>
              <br />
              <select id="filterByCampaign" ref="filterCampaign" class="form-control">
                <option value="">Tất cả Chương trình </option>
                <option repeat.for="item of ListCampaigns" value.bind="item.Id">${item.Name}</option>
              </select>
            </div>
            <div class="form-group col-md-2">
              <label for=""> Chọn Tình trạng </label>
              <br />
              <select name="filterStatus" ref="filterStatus" class="form-control">
                <option value="">- Tất cả -</option>
                <option value="A">Active</option>
                <option value="D">Deactive</option>
              </select>
            </div>
            <div class="form-group col-md-2" if.bind="false">
              <label for=""> Mã Order </label>
              <br />
              <input type="text" class="form-control" ref="filterOrderCode" placeholder="Nhập Mã Order">
            </div>

          </div>
        </form>
      </div>
    </div>
    <div class="form-group">
      <button type="button" class="btn btn-primary" click.delegate="AddCondition()" data-toggle="modal" data-target="#addEditCondition" disabled.bind="isViewOnly">
        <span class="glyphicon glyphicon-plus"></span> Tạo mới Điều kiện quay
      </button>
    </div>
    <div class="table-responsive">
      <table id="tableConditions" class="table table-bordered">
        <thead>
          <tr>
            <th>ID</th>
            <th>Chi nhánh</th>
            <!-- <th>Date Play</th>-->
            <th>Tên Chương trình</th>
            <!--<th>Mã Order</th>-->
            <th>Mã SP Áp dụng</th>
            <th>Từ ngày</th>
            <th>Đến ngày</th>
            <!--<th style="width: 5% ">Ngày tạo</th>-->
            <th>Tình trạng</th>
            <th>Hành động</th>
          </tr>
        </thead>
        <tbody ref="ConditionData" items.bind="ListConditions | filterByStatus:filterStatus.value | filterByOrderCode:filterOrderCode.value | filterByBranch : filterBranch | filterByCampaign: filterCampaign.value">
          <tr repeat.for="condition of ConditionData.items | takeFromTo: (current-1)* (itemperpage):current * (itemperpage)">
            <td>${condition.Id}</td>
            <td><div style="width: 300px;">${condition.BrandCode | branchName: ListBranchs}</div></td>
            <!-- <td>${condition.DatePlay | dateFormat:'DD/MM/YYYY hh:mm:ss A'}</td> -->
            <td><div style="width: 150px; word-wrap: break-word;">${condition.CampaignName}</div></td>
            <!--<td>${condition.OrderCode}</td>-->
            <td><div style="width: 550px; word-wrap: break-word;">${condition.ApplyProductCode}</div></td>
            <td>${condition.DateFrom | dateFormat:'DD/MM/YYYY hh:mm:ss A'}</td>
            <td>${condition.DateTo | dateFormat:'DD/MM/YYYY hh:mm:ss A'}</td>
            <!--<td>${condition.CreatedDate | dateFormat:'DD/MM/YYYY hh:mm:ss A'}</td>-->
            <td>${condition.Status | status}</td>
            <td>
              <button type="button" class="btn btn-info btn-xs" click.delegate="$parent.EditCondition(condition)" data-toggle="modal" data-target="#addEditCondition" disabled.bind="isViewOnly">
                <span class="glyphicon glyphicon-edit"></span> Sửa
              </button>
              <button if.bind="condition.Status==='D'" type="button" class="btn btn-success btn-xs" click.delegate="$parent.ChangeConditionStatus(condition)" disabled.bind="isViewOnly">
                <span class="glyphicon glyphicon-ok"></span> Active
              </button>
              <button if.bind="condition.Status==='A'" type="button" class="btn btn-danger btn-xs" click.delegate="$parent.ChangeConditionStatus(condition)" disabled.bind="isViewOnly">
                <span class="glyphicon glyphicon-remove"></span> Deactive
              </button>
            </td>
          </tr>
          <tr if.bind="ConditionData.items.length > 0">
            <td colspan="10">
              <pagination page-size.bind="pagesize" total.bind="ConditionData.items.length" item-per-page.bind="itemperpage" current-page.bind="current"></pagination>
            </td>
          </tr>
          <tr if.bind="!ListConditions || ConditionData.items.length <= 0">
            <td colspan="10">
              Không tìm thấy điều kiện nào.
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <!-- EDIT CONDITION FORM -->
    <div id="addEditCondition" ref="addEditCondition" class="modal fade" role="dialog">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            <h4 if.bind="isEdit" class="modal-title">Cập nhật Condition</h4>
            <h4 if.bind="!isEdit" class="modal-title">Thêm mới Condition</h4>
          </div>
          <div class="modal-body">
            <div class="row">
                <!-- <div class="col-xs-6 form-group">
                  <label class="control-label">Brand Code</label>
                  <input class="form-control" type="text" value.bind="currentCondition.BrandCode" placeholder="Nhập Brand Code"/>
                </div> -->
                <div class="col-xs-6 form-group required">
                  <label class="control-label">Chi nhánh</label>
                  <br />
                  <select class="form-control chinhanh-select2" id="ddlAddEditConditionBranch" value.two-way="currentCondition.BrandCode">
                    <option repeat.for="item of ListBranchs" value.bind="item.BranchsCodePos"> ${item.BranchsCodePos} - ${item.BranchsAdd}</option>
                  </select>
                </div>
                <div class="col-xs-6 form-group required">
                  <label class="control-label">Chọn Chương trình</label>
                  <select value.two-way="currentCondition.CampaignId" class="form-control" required="required">
                    <option value="" selected="selected">Tất cả Chương trình </option>
                    <option repeat.for="item of ListCampaigns" model.bind="item.Id" value.bind="item.Id">${item.Name}</option>
                  </select>
                </div>
                <div class="col-xs-6 form-group">
                  <label class="control-label">Ngày chơi</label>
                  <!-- <input class="form-control" type="text" value.bind="currentCondition.DatePlay" placeholder="Nhập Date Play"/> -->
                  <div class="input-group dtDatePlay">
                      <input type="text" id="dtDatePlay" class="form-control"  value.bind="currentCondition.DatePlay | dateFormat:'M/D/YYYY hh:mm:ss a' "><span class="input-group-addon"><i class="glyphicon glyphicon-th" enabled="false"></i></span>
                  </div>
                </div>
                <div class="col-xs-6 form-group">
                  <label class="control-label">Mã Order</label>
                  <input class="form-control" type="text" value.bind="currentCondition.OrderCode" placeholder="Nhập Mã Order" />
                </div>
                <div class="col-xs-6 form-group">
                  <label class="control-label">Mã SP Áp dụng</label>
                  <input class="form-control" type="text" value.bind="currentCondition.ApplyProductCode" placeholder="Nhập Mã SP Áp dụng"/>
                </div>
                <div class="col-xs-6 form-group required">
                  <label class="control-label">Từ ngày</label>
                  <!-- <input class="form-control" type="text" value.bind="currentCondition.DateFrom" placeholder="Nhập Date From" required="required" /> -->
                  <div class="input-group dtDateFrom">
                      <input type="text" id="dtDateFrom" class="form-control" value.two-way="currentCondition.DateFrom | dateFormat:'M/D/YYYY hh:mm:ss a' " required="required" ><span class="input-group-addon"><i class="glyphicon glyphicon-th"></i></span>
                  </div>
                </div>
                <div class="col-xs-6 form-group required">
                  <label class="control-label">Đến ngày</label>
                  <!-- <input class="form-control" type="text" value.bind="currentCondition.DateTo" placeholder="Nhập Date To" required="required" /> -->
                  <div class="input-group dtDateTo">
                      <input type="text" id="dtDateTo" class="form-control" value.two-way="currentCondition.DateTo | dateFormat:'M/D/YYYY hh:mm:ss a' " required="required" ><span class="input-group-addon"><i class="glyphicon glyphicon-th"></i></span>
                  </div>
                </div>
                <div class="col-xs-6 form-group required">
                  <label class="control-label">Tình trạng</label>
                  <select value.bind="currentCondition.Status" class="form-control" required="required">
                    <option value="A">Active</option>
                    <option value="D">Deactive</option>
                  </select>
                </div>
            </div>
          </div>
          <div class="modal-footer">
            <span style="float: left; color: red">(*) là các trường bắt buộc nhập</span>
            <button if.bind="isEdit" type="button" class="btn btn-danger" click.delegate="SubmitCondition()">Cập nhật</button>
            <button if.bind="!isEdit" type="button" class="btn btn-danger" click.delegate="SubmitCondition()">Thêm</button>
            <button type="button" class="btn btn-default" data-dismiss="modal">Đóng</button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section if.bind="isNoAccess">
    <div class="form-group">
      <span>Bạn không có quyền truy cập trang này.</span>
    </div>
  </section>

  <style>

span.select2-container {
    width: 100% !important;
}

.select2-container .select2-selection--single {
    height: 34px !important;
}

.form-inline .form-control {
    width: 100% !important;
}

.select2-container--default .select2-selection--single {
    border: 1px solid #ccc !important;
}

th {
    text-align: center;
    vertical-align: center;
}
    </style>
</template>